---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import BlogLayout from '../../layouts/BlogLayout.astro';
import NavItem from '../../components/NavItem.astro';

export const getStaticPaths = (async () => {
  const Posts = await getCollection('posts')
  return Posts.map((post) => ({
    params: { slug: post.slug},
    props: { post: post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const frontmatter = post.data;

const { Content, headings } = await post.render();

// Format date
const publishDate = frontmatter.date ? new Date(frontmatter.date).toLocaleDateString('es-ES', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}) : '';

// Calculate reading time (rough estimate)
const readingTime = Math.ceil((post.body?.length || 0) / 1000) || 5;

// Mock popular posts data (you can replace this with real data from your collection)
const popularPosts = [
  {
    title: "Visual Studio Code Makefile Action Extension",
    slug: "post-01",
    readTime: 8,
    views: 1250
  },
  {
    title: "Marlin Configuration Action Extension",
    slug: "post-02", 
    readTime: 12,
    views: 980
  },
  {
    title: "QT installation & configuration for Raspberry Pi 4",
    slug: "post-03",
    readTime: 15,
    views: 750
  }
];

// Mock comments data (you can replace this with real data from your CMS/database)
const comments = [
  {
    id: 1,
    author: "María González",
    avatar: "M",
    content: "Excelente artículo! Me ha ayudado mucho a entender los conceptos. Gracias por compartir tu conocimiento.",
    date: new Date('2024-03-15'),
    replies: [
      {
        id: 2,
        author: "Jesus Velez",
        avatar: "J",
        content: "¡Gracias María! Me alegra saber que te fue útil. Si tienes alguna pregunta específica, no dudes en comentar.",
        date: new Date('2024-03-16')
      }
    ]
  },
  {
    id: 3,
    author: "Carlos Ruiz",
    avatar: "C",
    content: "¿Podrías hacer un tutorial más detallado sobre la implementación? Me gustaría profundizar más en este tema.",
    date: new Date('2024-03-18'),
    replies: []
  },
  {
    id: 4,
    author: "Ana Martínez",
    avatar: "A",
    content: "Perfecto timing! Justo necesitaba esta información para un proyecto. Todo muy bien explicado.",
    date: new Date('2024-03-20'),
    replies: []
  }
];

// Group headings by level for dropdown functionality
const groupedHeadings = headings.reduce((acc, heading, index) => {
  if (heading.depth === 1 || heading.depth === 2) {
    acc.push({
      ...heading,
      index: index + 1,
      children: []
    });
  } else if (acc.length > 0) {
    acc[acc.length - 1].children.push({
      ...heading,
      index: index + 1
    });
  }
  return acc;
}, [] as any[]);
---

<BlogLayout title={frontmatter.title}>
  <!-- Navigation -->
  <nav class="flex gap-5 flex-row justify-center w-full my-10 px-4">
    <NavItem title="← Blog Home" href="/DevBlog" />
    <NavItem title="All Posts" href="/Blog/Posts" />
    <NavItem title="Portfolio" href="https://jesusvelez.xyz" />
  </nav>

  <!-- Article Header -->
  <article class="max-w-4xl mx-auto px-4 lg:px-8">
    <header class="mb-12 text-center">
      <!-- Category/Tags -->
      {frontmatter.tags && (
        <div class="flex flex-wrap justify-center gap-2 mb-4">
          {frontmatter.tags.map((tag: string) => (
            <span class="px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full dark:bg-blue-900 dark:text-blue-300">
              {tag}
            </span>
          ))}
        </div>
      )}
      
      <!-- Title -->
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 dark:text-white mb-6 leading-tight">
        {frontmatter.title}
      </h1>
      
      <!-- Subtitle/Description -->
      {frontmatter.description && (
        <p class="text-xl text-gray-600 dark:text-gray-300 mb-6 max-w-2xl mx-auto">
          {frontmatter.description}
        </p>
      )}
      
      <!-- Meta Information -->
      <div class="flex flex-wrap items-center justify-center gap-6 text-sm text-gray-500 dark:text-gray-400">
        {frontmatter.author && (
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
            </svg>
            <span class="font-medium">{frontmatter.author}</span>
          </div>
        )}
        
        {publishDate && (
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
            </svg>
            <time datetime={frontmatter.date?.toISOString()}>{publishDate}</time>
          </div>
        )}
        
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
          </svg>
          <span>{readingTime} min de lectura</span>
        </div>
      </div>
      
      <!-- Divider -->
      <div class="w-24 h-1 bg-gradient-to-r from-blue-500 to-cyan-500 mx-auto mt-8"></div>
    </header>

  <!-- Article Header -->
  <article class="max-w-7xl mx-auto px-4 lg:px-8">
    <header class="mb-12 text-center">
      <!-- Category/Tags -->
      {frontmatter.tags && (
        <div class="flex flex-wrap justify-center gap-2 mb-4">
          {frontmatter.tags.map((tag: string) => (
            <span class="px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full dark:bg-blue-900 dark:text-blue-300">
              {tag}
            </span>
          ))}
        </div>
      )}
      
      <!-- Title -->
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 dark:text-white mb-6 leading-tight">
        {frontmatter.title}
      </h1>
      
      <!-- Subtitle/Description -->
      {frontmatter.description && (
        <p class="text-xl text-gray-600 dark:text-gray-300 mb-6 max-w-3xl mx-auto">
          {frontmatter.description}
        </p>
      )}
      
      <!-- Meta Information -->
      <div class="flex flex-wrap items-center justify-center gap-6 text-sm text-gray-500 dark:text-gray-400">
        {frontmatter.author && (
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
            </svg>
            <span class="font-medium">{frontmatter.author}</span>
          </div>
        )}
        
        {publishDate && (
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
            </svg>
            <time datetime={frontmatter.date?.toISOString()}>{publishDate}</time>
          </div>
        )}
        
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
          </svg>
          <span>{readingTime} min de lectura</span>
        </div>
      </div>
      
      <!-- Divider -->
      <div class="w-24 h-1 bg-gradient-to-r from-blue-500 to-cyan-500 mx-auto mt-8"></div>
    </header>

    <!-- Three Column Layout -->
    <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
      <!-- Left Sidebar - Table of Contents with Dropdowns -->
      {groupedHeadings.length > 0 && (
        <aside class="xl:col-span-3">
          <div class="sticky top-8 bg-gray-50 dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
              </svg>
              Tabla de contenidos
            </h3>
            <nav>
              <div class="space-y-2">
                {groupedHeadings.map((heading) => (
                  <div class="toc-item">
                    <div class="flex items-center">
                      <a 
                        href={`#${heading.slug}`}
                        class="flex-1 text-sm text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 px-3 font-medium"
                      >
                        <span class="text-blue-500 font-medium mr-2">{heading.index}.</span>
                        {heading.text}
                      </a>
                      {heading.children.length > 0 && (
                        <button 
                          class="dropdown-toggle p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
                          onclick="toggleDropdown(this)"
                        >
                          <svg class="w-4 h-4 transform transition-transform" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                          </svg>
                        </button>
                      )}
                    </div>
                    {heading.children.length > 0 && (
                      <div class="dropdown-content hidden ml-4 mt-1 space-y-1">
                        {heading.children.map((subHeading: any) => (
                          <a 
                            href={`#${subHeading.slug}`}
                            class="block text-xs text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 py-1 px-3 rounded hover:bg-gray-100 dark:hover:bg-gray-700"
                            style={`margin-left: ${(subHeading.depth - 3) * 0.75}rem`}
                          >
                            <span class="text-blue-400 mr-2">{subHeading.index}.</span>
                            {subHeading.text}
                          </a>
                        ))}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </nav>
          </div>
        </aside>
      )}
      
      <!-- Main Content -->
      <main class={`${groupedHeadings.length > 0 ? 'xl:col-span-6' : 'xl:col-span-9'} min-w-0`}>
        <div class="prose prose-lg prose-gray dark:prose-invert max-w-none 
                    prose-headings:text-gray-900 dark:prose-headings:text-white
                    prose-p:text-gray-700 dark:prose-p:text-gray-300
                    prose-a:text-blue-600 dark:prose-a:text-blue-400
                    prose-strong:text-gray-900 dark:prose-strong:text-white
                    prose-code:text-pink-600 dark:prose-code:text-pink-400
                    prose-code:bg-gray-100 dark:prose-code:bg-gray-800
                    prose-code:px-1 prose-code:py-0.5 prose-code:rounded
                    prose-pre:bg-gray-900 dark:prose-pre:bg-gray-950
                    prose-pre:border prose-pre:border-gray-700">
          <Content />
        </div>
        
        <!-- Comments Section -->
        <section class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-700">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-8 flex items-center gap-2">
            <svg class="w-6 h-6 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z" clip-rule="evenodd"/>
            </svg>
            Comentarios ({comments.length})
          </h2>
          
          <!-- Comments List -->
          <div class="space-y-6">
            {comments.map((comment) => (
              <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700">
                <!-- Comment Header -->
                <div class="flex items-start space-x-4">
                  <div class="flex-shrink-0">
                    <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                      {comment.avatar}
                    </div>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center space-x-2 mb-2">
                      <h4 class="text-sm font-semibold text-gray-900 dark:text-white">
                        {comment.author}
                      </h4>
                      <span class="text-xs text-gray-500 dark:text-gray-400">
                        {comment.date.toLocaleDateString('es-ES', { 
                          year: 'numeric', 
                          month: 'long', 
                          day: 'numeric' 
                        })}
                      </span>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
                      {comment.content}
                    </p>
                    
                    <!-- Comment Actions -->
                    <div class="flex items-center space-x-4 mt-3">
                      <button class="text-xs text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 flex items-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
                        </svg>
                        Me gusta
                      </button>
                      <button class="text-xs text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 flex items-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Responder
                      </button>
                    </div>
                  </div>
                </div>
                
                <!-- Replies -->
                {comment.replies.length > 0 && (
                  <div class="ml-14 mt-4 space-y-4">
                    {comment.replies.map((reply) => (
                      <div class="bg-white dark:bg-gray-900 rounded-lg p-4 border border-gray-100 dark:border-gray-600">
                        <div class="flex items-start space-x-3">
                          <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-semibold text-xs">
                              {reply.avatar}
                            </div>
                          </div>
                          <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2 mb-1">
                              <h5 class="text-xs font-semibold text-gray-900 dark:text-white">
                                {reply.author}
                                {reply.author === 'Jesus Velez' && (
                                  <span class="ml-1 px-2 py-0.5 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-full">
                                    Autor
                                  </span>
                                )}
                              </h5>
                              <span class="text-xs text-gray-500 dark:text-gray-400">
                                {reply.date.toLocaleDateString('es-ES', { 
                                  year: 'numeric', 
                                  month: 'long', 
                                  day: 'numeric' 
                                })}
                              </span>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 text-xs leading-relaxed">
                              {reply.content}
                            </p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            ))}
          </div>
          
          <!-- Add Comment Form -->
          <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
              Deja un comentario
            </h3>
            <form class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input
                  type="text"
                  placeholder="Tu nombre"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"
                />
                <input
                  type="email"
                  placeholder="Tu email"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"
                />
              </div>
              <textarea
                rows="4"
                placeholder="Escribe tu comentario..."
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 resize-none"
              ></textarea>
              <button
                type="submit"
                class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200 font-medium"
              >
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                </svg>
                Publicar comentario
              </button>
            </form>
          </div>
        </section>
      </main>
      
      <!-- Right Sidebar - Popular Posts -->
      <aside class="xl:col-span-3">
        <div class="sticky top-8 space-y-6">
          <!-- Popular Posts -->
          <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
              </svg>
              Posts Populares
            </h3>
            <div class="space-y-4">
              {popularPosts.map((popularPost, index) => (
                <a
                  href={`/Blog/${popularPost.slug}`}
                  class="block group hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg p-3 transition-colors duration-200"
                >
                  <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0 w-8 h-8 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                      {index + 1}
                    </div>
                    <div class="flex-1 min-w-0">
                      <h4 class="text-sm font-medium text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 line-clamp-2 mb-1">
                        {popularPost.title}
                      </h4>
                      <div class="flex items-center text-xs text-gray-500 dark:text-gray-400 space-x-3">
                        <span class="flex items-center gap-1">
                          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                          </svg>
                          {popularPost.readTime} min
                        </span>
                        <span class="flex items-center gap-1">
                          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                          </svg>
                          {popularPost.views}
                        </span>
                      </div>
                    </div>
                  </div>
                </a>
              ))}
            </div>
          </div>

          <!-- Newsletter Signup -->
          <div class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-800 dark:to-gray-900 rounded-xl p-6 border border-blue-200 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
              📧 Newsletter
            </h3>
            <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">
              Recibe los últimos artículos y tutoriales directamente en tu email.
            </p>
            <form class="space-y-3">
              <input
                type="email"
                placeholder="tu@email.com"
                class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"
              />
              <button
                type="submit"
                class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg transition-colors duration-200 font-medium"
              >
                Suscribirse
              </button>
            </form>
          </div>

          <!-- Tags Cloud -->
          <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
              </svg>
              Tags
            </h3>
            <div class="flex flex-wrap gap-2">
              {['TypeScript', 'React', 'Astro', 'Linux', 'VSCode', 'IoT', 'Raspberry Pi', 'Arduino'].map((tag) => (
                <span class="px-2 py-1 text-xs bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 cursor-pointer transition-colors">
                  {tag}
                </span>
              ))}
            </div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Article Footer -->
    <footer class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-700">
      <!-- Share Section -->
      <div class="text-center mb-8">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
          ¿Te gustó este artículo?
        </h3>
        <div class="flex flex-wrap justify-center gap-4">
          <a
            href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(frontmatter.title)}&url=${encodeURIComponent(`https://blog.jesusvelez.xyz/Blog/${post.slug}`)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors duration-200"
          >
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
            Compartir en X
          </a>
          
          <a
            href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(`https://blog.jesusvelez.xyz/Blog/${post.slug}`)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-lg transition-colors duration-200"
          >
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
            Compartir en LinkedIn
          </a>
        </div>
      </div>

      <!-- Navigation to other posts -->
      <div class="flex flex-col sm:flex-row justify-between items-center gap-4 py-6">
        <a
          href="/Blog/Posts"
          class="inline-flex items-center gap-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg transition-colors duration-200"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          Ver todos los posts
        </a>
        
        <a
          href="/DevBlog"
          class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200"
        >
          Volver al Blog
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
          </svg>
        </a>
      </div>
    </footer>
  </article>
</BlogLayout>

<script>
  // Dropdown functionality for TOC
  function toggleDropdown(button: HTMLElement) {
    const content = button.parentElement?.parentElement?.querySelector('.dropdown-content') as HTMLElement;
    const icon = button.querySelector('svg') as SVGElement;
    
    if (content && content.classList.contains('hidden')) {
      content.classList.remove('hidden');
      if (icon) icon.style.transform = 'rotate(180deg)';
    } else if (content) {
      content.classList.add('hidden');
      if (icon) icon.style.transform = 'rotate(0deg)';
    }
  }

  // Make toggleDropdown globally available
  (window as any).toggleDropdown = toggleDropdown;

  // Smooth scrolling for table of contents links
  document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('a[href^="#"]');
    
    tocLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const href = (e.currentTarget as HTMLAnchorElement)?.getAttribute('href');
        const target = href ? document.querySelector(href) : null;
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Highlight current section in TOC
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const id = entry.target.getAttribute('id');
        const tocLink = document.querySelector(`a[href="#${id}"]`);
        
        if (entry.isIntersecting && tocLink) {
          // Remove active class from all TOC links
          document.querySelectorAll('a[href^="#"]').forEach(link => {
            link.classList.remove('text-blue-600', 'dark:text-blue-400', 'font-semibold', 'bg-blue-50', 'dark:bg-blue-900');
          });
          
          // Add active class to current link
          tocLink.classList.add('text-blue-600', 'dark:text-blue-400', 'font-semibold', 'bg-blue-50', 'dark:bg-blue-900');
        }
      });
    }, {
      rootMargin: '-20% 0% -35% 0%'
    });

    // Observe all headings
    document.querySelectorAll('h1, h2, h3, h4, h5, h6').forEach(heading => {
      if (heading.id) {
        observer.observe(heading);
      }
    });

    // Auto-open TOC dropdowns that contain the current active section
    const activeLinks = document.querySelectorAll('.toc-item a[href^="#"]');
    activeLinks.forEach(link => {
      link.addEventListener('click', () => {
        const tocItem = link.closest('.toc-item');
        const dropdown = tocItem?.querySelector('.dropdown-content');
        const toggle = tocItem?.querySelector('.dropdown-toggle');
        
        if (dropdown && !dropdown.classList.contains('hidden')) {
          // Keep dropdown open if it contains the clicked link
        }
      });
    });
  });
</script>

<style>
  /* Custom styles for better readability */
  .prose {
    font-size: 1rem;
    line-height: 1.75;
  }
  
  .prose h1 {
    font-size: 1.875rem;
    font-weight: 700;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
  }
  
  .prose h1:first-child {
    margin-top: 0;
  }
  
  .prose h2 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
  }
  
  .prose h3 {
    font-size: 1.25rem;
    font-weight: 500;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
  }
  
  .prose p {
    margin-bottom: 1.5rem;
  }
  
  .prose ul, .prose ol {
    margin-bottom: 1.5rem;
  }
  
  .prose li {
    margin-bottom: 0.5rem;
  }
  
  .prose blockquote {
    border-left: 4px solid rgb(59 130 246);
    padding-left: 1.5rem;
    font-style: italic;
    background-color: rgb(249 250 251);
    padding-top: 1rem;
    padding-bottom: 1rem;
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    border-radius: 0 0.5rem 0.5rem 0;
  }
  
  .dark .prose blockquote {
    background-color: rgb(31 41 55);
  }

  /* TOC Dropdown Animation */
  .dropdown-content {
    transition: all 0.2s ease-in-out;
  }

  .dropdown-toggle svg {
    transition: transform 0.2s ease-in-out;
  }

  /* Line clamp utility */
  .line-clamp-2 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
  }
  
  /* Responsive grid adjustments */
  @media (max-width: 1279px) {
    .xl\:col-span-3 {
      order: 3;
      margin-top: 2rem;
    }
    
    .xl\:col-span-6 {
      order: 1;
    }
    
    .xl\:col-span-3:first-child {
      order: 2;
      margin-top: 2rem;
    }
  }

  /* Sticky positioning adjustments */
  @media (max-width: 1279px) {
    .sticky {
      position: static !important;
    }
  }

  /* Comments section styling */
  .comment-reply {
    border-left: 3px solid rgb(59 130 246);
    margin-left: 1rem;
    padding-left: 1rem;
  }

  /* Form focus styles */
  input:focus, textarea:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  /* Popular posts hover effects */
  .popular-post:hover .popular-post-title {
    color: rgb(37 99 235);
  }

  .dark .popular-post:hover .popular-post-title {
    color: rgb(96 165 250);
  }
</style>