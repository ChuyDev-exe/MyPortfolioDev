---
title: "Configuraci√≥n de Subdominios en Astro con Netlify"
date: 2024-07-22
description: "Gu√≠a completa para configurar subdominios en proyectos Astro desplegados en Netlify, incluyendo configuraci√≥n de _redirects y netlify.toml."
author: "Jesus Velez"
tags: ["astro", "netlify", "subdomain", "deployment", "web-development"]
---

# Configuraci√≥n de Subdominios en Astro con Netlify

¬øNecesitas configurar subdominios para tu proyecto Astro? En esta gu√≠a te ense√±o paso a paso c√≥mo configurar subdominios profesionales usando Netlify, perfecto para separar tu portfolio principal de tu blog.

## ¬øPor qu√© usar Subdominios?

Los subdominios ofrecen varias ventajas:

- **Separaci√≥n l√≥gica**: `blog.tudominio.com` vs `tudominio.com`
- **SEO mejorado**: Cada subdominio puede tener su propia estrategia
- **Organizaci√≥n**: Diferentes secciones para diferentes prop√≥sitos
- **Escalabilidad**: F√°cil de mantener y expandir

## Configuraci√≥n del Proyecto Astro

### 1. Estructura del Proyecto

```
src/
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ index.astro          # P√°gina principal (portfolio)
‚îÇ   ‚îú‚îÄ‚îÄ DevBlog.astro        # Blog principal
‚îÇ   ‚îî‚îÄ‚îÄ Blog/
‚îÇ       ‚îú‚îÄ‚îÄ Posts.astro      # Lista de posts
‚îÇ       ‚îî‚îÄ‚îÄ [slug].astro     # Posts individuales
‚îú‚îÄ‚îÄ middleware.ts            # Manejo de subdominios
‚îî‚îÄ‚îÄ layouts/
    ‚îú‚îÄ‚îÄ Layout.astro         # Layout principal
    ‚îî‚îÄ‚îÄ BlogLayout.astro     # Layout del blog
```

### 2. Configuraci√≥n de astro.config.mjs

```javascript
// astro.config.mjs
import { defineConfig } from 'astro/config';
import netlify from '@astrojs/netlify';
import tailwind from '@astrojs/tailwindcss';
import react from '@astrojs/react';

export default defineConfig({
  output: 'server',
  adapter: netlify({
    edgeMiddleware: false
  }),
  integrations: [
    tailwind(),
    react()
  ],
  site: 'https://jesusvelez.xyz',
  server: {
    port: 4321,
    host: true
  }
});
```

### 3. Middleware para Subdominios

```typescript
// src/middleware.ts
import type { MiddlewareHandler } from 'astro';

export const onRequest: MiddlewareHandler = async (context, next) => {
  const url = new URL(context.request.url);
  const hostname = url.hostname;
  
  // Extraer subdominio
  const subdomain = hostname.split('.')[0];
  
  // Guardar subdominio en locals para acceso en p√°ginas
  context.locals.subdomain = subdomain === 'blog' ? 'blog' : '';
  
  return next();
};
```

## Configuraci√≥n de Netlify

### 1. Archivo netlify.toml

```toml
# netlify.toml
[build]
  command = "npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "18"

# Configuraci√≥n para el dominio principal (portfolio)
[[redirects]]
  from = "https://jesusvelez.xyz/Blog/*"
  to = "https://blog.jesusvelez.xyz/Blog/:splat"
  status = 301
  force = true

[[redirects]]
  from = "https://jesusvelez.xyz/DevBlog"
  to = "https://blog.jesusvelez.xyz/DevBlog"
  status = 301
  force = true

# Configuraci√≥n para el subdominio blog
[[redirects]]
  from = "https://blog.jesusvelez.xyz/"
  to = "https://blog.jesusvelez.xyz/DevBlog"
  status = 200

# Configuraci√≥n espec√≠fica del subdominio blog
[[redirects]]
  from = "https://blog.jesusvelez.xyz/Blog/*"
  to = "/Blog/:splat"
  status = 200
  headers = { Host = "blog.jesusvelez.xyz" }

[[redirects]]
  from = "https://blog.jesusvelez.xyz/DevBlog"
  to = "/DevBlog"
  status = 200
  headers = { Host = "blog.jesusvelez.xyz" }

# Fallback para SPA
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Headers de seguridad
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
```

### 2. Archivo _redirects

```bash
# public/_redirects

# Subdominio blog - mapear rutas del blog
https://blog.jesusvelez.xyz/Blog/*  /Blog/:splat  200!
https://blog.jesusvelez.xyz/       /DevBlog      200!

# Dominio principal - redirigir rutas del blog al subdominio
https://jesusvelez.xyz/Blog/*  https://blog.jesusvelez.xyz/Blog/:splat  301!
https://jesusvelez.xyz/DevBlog https://blog.jesusvelez.xyz/DevBlog       301!

# Fallback para SPA y rutas din√°micas
/*  /index.html  200
```

## Configuraci√≥n DNS

### 1. Registros DNS necesarios

En tu proveedor de DNS (Cloudflare, GoDaddy, etc.):

```dns
# Registro A para dominio principal
jesusvelez.xyz        A    75.2.60.5

# Registro CNAME para subdominio blog
blog.jesusvelez.xyz   CNAME    jesusvelez.netlify.app
```

### 2. Configuraci√≥n en Netlify Dashboard

1. Ve a **Site settings** > **Domain management**
2. Agrega tu dominio personalizado: `jesusvelez.xyz`
3. Agrega el subdominio: `blog.jesusvelez.xyz`
4. Configura SSL autom√°tico

## Implementaci√≥n en el C√≥digo

### 1. P√°gina Principal Condicional

```astro
---
// src/pages/index.astro
export const prerender = false;

const subdomain = Astro.locals.subdomain?.toLowerCase() || '';
---

<Layout title="Jesus Velez Soto">
  {subdomain === '' && (
    <>
      <!-- Contenido del portfolio principal -->
      <nav class="flex gap-7 justify-center mt-12">
        <NavItem title="Experience" href="#Experiencia" />
        <NavItem title="Projects" href="#Projects"/>
        <NavItem title="Blog" href="https://blog.jesusvelez.xyz" />
      </nav>
      
      <!-- Resto del contenido del portfolio -->
    </>
  )}
</Layout>
```

### 2. P√°ginas del Blog

```astro
---
// src/pages/DevBlog.astro
import BlogLayout from "../layouts/BlogLayout.astro";
---

<BlogLayout title="Blog Dev">
  <nav class="flex gap-5 justify-center w-full my-10">
    <NavItem title="Portfolio" href="https://jesusvelez.xyz" />
    <NavItem title="All Posts" href="/Blog/Posts" />
  </nav>
  
  <!-- Contenido del blog -->
</BlogLayout>
```

## Testing y Debugging

### 1. Testing Local

```bash
# Ejecutar en desarrollo
npm run dev

# Simular subdominios localmente
# Agregar a /etc/hosts (macOS/Linux) o C:\Windows\System32\drivers\etc\hosts (Windows)
127.0.0.1 blog.localhost
127.0.0.1 localhost

# Acceder a:
# http://localhost:4321 (portfolio)
# http://blog.localhost:4321 (blog)
```

### 2. Verificaci√≥n de Redirecciones

```bash
# Verificar redirecciones con curl
curl -I https://jesusvelez.xyz/Blog/post-01
# Deber√≠a retornar 301 y redirigir a blog.jesusvelez.xyz

curl -I https://blog.jesusvelez.xyz/Blog/post-01
# Deber√≠a retornar 200
```

## Problemas Comunes y Soluciones

### 1. Certificados SSL

**Problema**: SSL no funciona en subdominio
```bash
# Soluci√≥n: Regenerar certificados
netlify sites:create
netlify deploy --prod
```

### 2. Redirecciones Infinitas

**Problema**: Loop de redirecciones
```toml
# Soluci√≥n: Usar force = true y orden correcto
[[redirects]]
  from = "https://domain.com/path"
  to = "https://subdomain.domain.com/path"
  force = true
  status = 301
```

### 3. Assets no cargan

**Problema**: CSS/JS no cargan en subdominio
```astro
<!-- Usar rutas absolutas -->
<link rel="stylesheet" href="/styles/global.css" />
<script src="/scripts/main.js"></script>
```

## Mejores Pr√°cticas

### 1. SEO y Meta Tags

```astro
---
// Diferentes meta tags por subdominio
const isBlogs = Astro.locals.subdomain === 'blog';
const baseUrl = isBlogs ? 'https://blog.jesusvelez.xyz' : 'https://jesusvelez.xyz';
---

<head>
  <title>{isBlogs ? 'Blog - ' : ''}{title}</title>
  <link rel="canonical" href={`${baseUrl}${Astro.url.pathname}`} />
  <meta property="og:url" content={`${baseUrl}${Astro.url.pathname}`} />
</head>
```

### 2. Analytics Separados

```astro
---
const analyticsId = Astro.locals.subdomain === 'blog' 
  ? 'GA_MEASUREMENT_ID_BLOG' 
  : 'GA_MEASUREMENT_ID_MAIN';
---

<!-- Google Analytics -->
<script async src={`https://www.googletagmanager.com/gtag/js?id=${analyticsId}`}></script>
```

## Despliegue

### 1. Build y Deploy

```bash
# Build del proyecto
npm run build

# Deploy a Netlify
netlify deploy --prod

# O usando Git (recomendado)
git add .
git commit -m "feat: subdomain configuration"
git push origin main
```

### 2. Verificaci√≥n Post-Deploy

Verifica que funcionen:
- ‚úÖ `https://jesusvelez.xyz` (portfolio)
- ‚úÖ `https://blog.jesusvelez.xyz` (blog)
- ‚úÖ Redirecciones autom√°ticas
- ‚úÖ SSL en ambos dominios

## Conclusi√≥n

Con esta configuraci√≥n tienes:

- üåê **Subdominios funcionales**: Separaci√≥n clara entre portfolio y blog
- üîí **SSL autom√°tico**: Seguridad en ambos dominios  
- ‚ö° **Redirecciones inteligentes**: URLs limpias y SEO-friendly
- üöÄ **Deploy automatizado**: CI/CD con Netlify

## Recursos Adicionales

- [Documentaci√≥n de Netlify Redirects](https://docs.netlify.com/routing/redirects/)
- [Astro Middleware Guide](https://docs.astro.build/en/guides/middleware/)
- [DNS Configuration Best Practices](https://developers.cloudflare.com/dns/)

¬øTienes problemas con la configuraci√≥n? ¬°D√©jame un comentario y te ayudo a resolverlo!
